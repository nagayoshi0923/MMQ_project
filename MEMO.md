# Murder Mystery Platform 開発メモ

## プロジェクト概要
オンラインで殺人ミステリーゲームを楽しめるプラットフォームの開発記録

## 開発開始日
2024年12月6日

---

## 開発記録

### 2024年12月6日 - プロジェクト初期化

#### 背景・課題
- 前回の開発でクラッシュが発生し、プロジェクトを最初から作り直すことに
- クラッシュの原因を分析し、安全な開発アプローチを採用（AIが管理すればGit必要ないかなって思ったけどそうはいかんかった）

#### 実施内容

##### 1. GitHubでのバージョン管理設定
- リポジトリ作成: `https://github.com/nagayoshimai/MMQ_project.git`
- ブランチ戦略の設定:
  - `main`: 本番環境用（安定版のみ）
  - `develop`: 開発統合用
  - `feature/*`: 機能開発用
- SourcetreeでのビジュアルGit管理を推奨

##### 2. 仕様書の整理・統合
- 9つの詳細な仕様書を`docs/`フォルダに配置
- README.mdを包括的なプロジェクト概要に更新
- 重複内容の統合と整理

##### 3. 安全なプロジェクト構造の設計
```
src/
├── components/
│   ├── ui/          # 再利用可能なUIコンポーネント
│   ├── game/        # ゲーム関連コンポーネント
│   └── auth/        # 認証関連コンポーネント
├── pages/           # ページコンポーネント
├── stores/          # 状態管理（Zustand）
├── types/           # TypeScript型定義
├── lib/             # ユーティリティ関数
├── utils/           # ヘルパー関数
└── hooks/           # カスタムフック
```

##### 4. 技術スタックの選択
- **フロントエンド**: React 18 + TypeScript + Vite
- **スタイリング**: Tailwind CSS
- **状態管理**: Zustand（段階的導入）
- **ルーティング**: React Router DOM
- **フォーム管理**: React Hook Form
- **アイコン**: Lucide React

##### 5. 安全な開発アプローチの採用
- 段階的実装（Phase別）
- 小さなコミット
- エラーハンドリングの強化
- メモリ管理の徹底
- テスト駆動開発

#### 学んだこと・気づき

##### 前回のクラッシュ要因の分析
1. **複雑な状態管理**: ゲーム状態とUI状態の混在
2. **リアルタイム通信の複雑さ**: WebSocket接続の不安定性
3. **大量のデータ処理**: 証拠品やプレイヤー情報の管理
4. **メモリリーク**: イベントリスナーの適切なクリーンアップ不足

##### 安全な開発戦略
1. **段階的実装**: 各機能を小さなブランチで実装
2. **テスト駆動**: 各機能実装前にテストケースを作成
3. **メモリ管理**: useEffectのクリーンアップ関数を必ず実装
4. **エラーハンドリング**: try-catch文とエラーバウンダリの実装

#### 困ったこと・課題

##### Git管理での問題
- `feature`ブランチが既に存在していて、新しいブランチ作成時にエラー
- 解決方法: 既存の`feature`ブランチを削除してから新規作成

##### 依存関係の警告
- npm install時に複数のdeprecated警告が発生
- セキュリティ脆弱性が2件検出
- 対応: 後で`npm audit fix`で修正予定

#### 次のステップ
1. ✅ 基本的なUIコンポーネントの実装
2. 認証システム（デモモード）の実装
3. ゲームロジックの段階的実装
4. リアルタイム通信の実装

---

### 2024年12月6日 - UIコンポーネントの実装

#### 実施内容

##### 1. 基本的なUIコンポーネントの作成
- **Button コンポーネント**: 複数バリエーション（primary, secondary, outline, ghost, destructive）
- **Input コンポーネント**: ラベル、エラー表示、ヘルパーテキスト対応
- **Card コンポーネント**: 複数バリエーション（default, outlined, elevated, glass）
- **LoadingSpinner コンポーネント**: サイズと色のカスタマイズ対応

##### 2. ページコンポーネントの更新
- LoginPage: 新しいUIコンポーネントを使用
- RegisterPage: フォーム要素をInputコンポーネントに置き換え
- LobbyPage: Cardコンポーネントを使用してレイアウト改善

##### 3. コンポーネント設計の特徴
- **TypeScript**: 完全な型安全性
- **アクセシビリティ**: 適切なラベルとフォーカス管理
- **再利用性**: プロパティによる柔軟なカスタマイズ
- **一貫性**: 統一されたデザインシステム

#### 学んだこと・気づき

##### コンポーネント設計のベストプラクティス
1. **forwardRefの使用**: 親コンポーネントからのrefアクセスを可能に
2. **デフォルトプロパティ**: 使いやすいデフォルト値を設定
3. **クラス名の結合**: clsxとtailwind-mergeで柔軟なスタイリング
4. **サブコンポーネント**: CardHeader, CardTitle等の構成要素を分離

##### エラーハンドリングの強化
- Inputコンポーネントでのエラー表示
- アイコン付きのエラーメッセージ
- 視覚的なフィードバックの提供

#### 困ったこと・課題

##### TypeScriptの型定義
- forwardRefの型定義が複雑
- 解決方法: 既存のパターンを参考に適切な型を設定

##### スタイリングの一貫性
- 複数のコンポーネントで同じスタイルを適用
- 解決方法: 共通のスタイルをユーティリティクラスとして定義

#### 次のステップ
1. 残りのページコンポーネントの更新
2. 認証システム（デモモード）の実装
3. 状態管理の実装
4. ゲームロジックの段階的実装

---

### 2024年12月6日 - エラー修正

#### 発生したエラー
1. **react-error-boundaryパッケージ不足**: App.tsxで使用しているがインストールされていない
2. **border-borderクラス未定義**: Tailwind CSSで存在しないクラスを使用
3. **manifest.json 404エラー**: PWA用のマニフェストファイルが存在しない

#### 修正内容
1. **パッケージインストール**: `npm install react-error-boundary`
2. **CSS修正**: `border-border`を`border-mystery-600`に変更
3. **PWAファイル作成**: `public/manifest.json`と`public/vite.svg`を作成

#### 学んだこと
- 依存関係の管理の重要性
- Tailwind CSSのカスタムクラス定義の必要性
- PWA対応時のファイル構造の重要性

#### 修正後の状況
- 開発サーバーが正常に起動
- エラーが解消され、アプリケーションが表示可能

---

## 開発のベストプラクティス

### コミットメッセージの規則
- `feat:` 新機能
- `fix:` バグ修正
- `docs:` ドキュメント更新
- `style:` コードスタイルの変更
- `refactor:` リファクタリング
- `test:` テストの追加・修正
- `chore:` その他の変更

### ブランチ命名規則
- `feature/機能名`: 新機能開発
- `bugfix/修正内容`: バグ修正
- `hotfix/緊急修正`: 緊急修正

### コード品質管理
- TypeScriptのstrict mode有効
- ESLintでのコード品質チェック
- Prettierでのコードフォーマット統一
- 各機能実装後のテスト実行

---

## 参考資料・リンク

### 技術ドキュメント
- [React 18 公式ドキュメント](https://react.dev/)
- [TypeScript 公式ドキュメント](https://www.typescriptlang.org/)
- [Tailwind CSS 公式ドキュメント](https://tailwindcss.com/)
- [Zustand 公式ドキュメント](https://zustand-demo.pmnd.rs/)

### プロジェクト管理
- [GitHub リポジトリ](https://github.com/nagayoshimai/MMQ_project)
- [Sourcetree ダウンロード](https://www.sourcetreeapp.com/)

---

## メモ・アイデア

### 今後の改善点
- エラーハンドリングの強化
- パフォーマンス最適化
- アクセシビリティの向上
- モバイル対応の強化

### 書籍化に向けた記録ポイント
- 開発過程の詳細な記録
- 技術的な判断理由
- 問題解決のプロセス
- 学習したことの整理

---

### 2024年12月6日 - ゲーム機能の完全実装

#### 実施内容

##### 1. ゲーム状態管理ストア（gameStore）の実装
- **GameState型定義**: フェーズ、証拠、キャラクター、投票の完全な型定義
- **5つのゲームフェーズ**: overview, investigation, discussion, voting, results
- **証拠システム**: 4つのカテゴリ（物理的、証言、文書、デジタル）での証拠管理
- **キャラクター管理**: アリバイ、動機、割り当て状態の管理
- **投票システム**: 重複投票防止とリアルタイム結果表示
- **タイマー管理**: フェーズ別時間設定と一時停止・再開機能

##### 2. ゲームコンポーネントの実装
- **GamePhaseManager**: フェーズ進行管理とタイマー表示
- **EvidencePanel**: 証拠の追加・表示・公開機能
- **VotingPanel**: 投票システムと結果表示
- **CharacterAssignment**: キャラクター選択と割り当て管理
- **Chat**: ゲーム内チャット機能（既存）

##### 3. GamePageの完全統合
- **レスポンシブレイアウト**: 4カラムグリッドでの最適化
- **フェーズ別表示**: 各フェーズに応じたコンポーネント表示
- **ゲーム初期化**: ルーム情報とシナリオデータの連携
- **状態管理統合**: 全ストアとの連携とクリーンアップ

##### 4. デモデータの拡張
- **6人のキャラクター**: 容疑者5人、刑事1人の詳細情報
- **アリバイ・動機**: 各キャラクターの詳細な背景情報
- **シナリオ情報**: 事件の詳細な説明と設定

#### 学んだこと・気づき

##### 複雑な状態管理の実装
- **Zustandの活用**: 複数のストア間での状態共有
- **型安全性**: TypeScriptでの厳密な型定義
- **永続化**: localStorageでの状態保持

##### コンポーネント設計のベストプラクティス
- **単一責任の原則**: 各コンポーネントが明確な役割を持つ
- **再利用性**: プロパティによる柔軟なカスタマイズ
- **エラーハンドリング**: 適切な条件分岐とフォールバック

##### ゲームロジックの実装
- **フェーズ管理**: 状態に応じた表示切り替え
- **権限管理**: ホスト権限での操作制限
- **リアルタイム更新**: 状態変更の即座な反映

#### 困ったこと・課題

##### 状態管理の複雑さ
- **複数ストア間の連携**: 適切な依存関係の管理
- **メモリリーク防止**: useEffectのクリーンアップ関数の実装

##### コンポーネント間の通信
- **プロパティドリリング**: 深い階層での状態共有
- **型定義の一貫性**: 複数ファイルでの型定義の統一

#### 次のステップ
1. **リアルタイム通信**: WebSocketでの実際の通信実装
2. **UI/UX改善**: アニメーションとレスポンシブ対応
3. **テスト実装**: 各コンポーネントの単体テスト
4. **パフォーマンス最適化**: メモ化とレンダリング最適化

---

*このメモは開発の進行に合わせて随時更新されます*
